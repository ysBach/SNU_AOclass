

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>1. Basics about FITS &#8212; SNU AO Class</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-examples.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chaps/01-fits-basic';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2. Centering" href="02-center.html" />
    <link rel="prev" title="4.6. About astropy.fits" href="python_prep/03-FITS_and_astropy.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    SNU AO Class
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Intro</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="00-Syllabus.html">An Example Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="00-Philosophy.html">Philosophy</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Prerequisite</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="prerequisites/00-1_Softwares.html">1. Software Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="prerequisites/00-2_UNIX.html">2. UNIX Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="prerequisites/00-3_Prepare_Python.html">3. (IMPORTANT) Python Environment</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="python_prep/00-python_prep.html">4. Python Preparation Course</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="python_prep/01-numpy.html">4.4. Numpy Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_prep/02-pandas.html">4.5. Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_prep/03-FITS_and_astropy.html">4.6. About <code class="docutils literal notranslate"><span class="pre">astropy.fits</span></code></a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Python in Astronomy</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">1. Basics about FITS</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-center.html">2. Centering</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Homework Assignments</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="prerequisites/99-HW_swtools.html">HW Software &amp; Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_prep/99-HW_python_pathlib.html">HW Python Basic &amp; <code class="docutils literal notranslate"><span class="pre">pathlib</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="python_prep/99-HW_numpy.html">HW <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="python_prep/99-HW_pandas.html">HW <code class="docutils literal notranslate"><span class="pre">pandas</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="python_prep/99-HW_astropy-fits.html">HW <code class="docutils literal notranslate"><span class="pre">astropy.fits</span></code></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ysBach/SNU_AOclass" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ysBach/SNU_AOclass/edit/master/JupyterBook/chaps/01-fits-basic.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ysBach/SNU_AOclass/issues/new?title=Issue%20on%20page%20%2Fchaps/01-fits-basic.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chaps/01-fits-basic.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Basics about FITS</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#astropy-fits">1.1. <code class="docutils literal notranslate"><span class="pre">astropy.fits</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#displaying-data">1.2. Displaying Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#making-new-fits-and-saving">1.3. Making New FITS and Saving</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-numpy-slicing">1.3.1. Using Numpy Slicing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-astropy-nddata-cutout2d">1.3.2. Using <code class="docutils literal notranslate"><span class="pre">astropy.nddata.Cutout2D</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iraf-like-slicing">1.3.3. IRAF-like Slicing</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="basics-about-fits">
<span id="ch-fits-basic"></span><h1><span class="section-number">1. </span>Basics about FITS<a class="headerlink" href="#basics-about-fits" title="Permalink to this headline">#</a></h1>
<p>This part will teach you:</p>
<ol class="arabic simple">
<li><p>Read/write FITS files.</p></li>
<li><p>Crop (cutout) a small region of the FITS image.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ignore this cell if you encounter errors</span>
<span class="o">%</span><span class="k">load_ext</span> version_information
<span class="kn">import</span> <span class="nn">time</span>
<span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S (%Z = GMT%z)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;This notebook was generated at </span><span class="si">{</span><span class="n">now</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>

<span class="n">vv</span> <span class="o">=</span> <span class="o">%</span><span class="k">version_information</span> astropy, numpy, scipy, matplotlib, version_information
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vv</span><span class="o">.</span><span class="n">packages</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">pkg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">10s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">pkg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This notebook was generated at 2023-04-19 16:56:31 (KST = GMT+0900) 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 Python     3.10.10 64bit [Clang 14.0.6 ]
1 IPython    8.12.0
2 OS         macOS 13.1 arm64 arm 64bit
3 astropy    5.2.2
4 numpy      1.24.2
5 scipy      1.10.1
6 matplotlib 3.7.1
7 version_information 1.0.4
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %matplotlib notebook</span>
<span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
<span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">get_ipython</span>
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;
<span class="n">InteractiveShell</span><span class="o">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s1">&#39;last_expr&#39;</span>
<span class="n">ipython</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.time</span> <span class="kn">import</span> <span class="n">Time</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">CCDData</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>

<span class="kn">import</span> <span class="nn">ysfitsutilpy</span> <span class="k">as</span> <span class="nn">yfu</span>
<span class="kn">import</span> <span class="nn">ysphotutilpy</span> <span class="k">as</span> <span class="nn">ypu</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
<span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">})</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">_tool_visualization</span> <span class="k">as</span> <span class="nn">vis</span>

<span class="n">DATAPATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../../../Tutorial_Data&#39;</span><span class="p">)</span>
<span class="n">TMPDIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;tmp&#39;</span><span class="p">)</span>
<span class="n">TMPDIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">allfits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">DATAPATH</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*p4179*.fits&quot;</span><span class="p">))</span>
<span class="n">allfits</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">allfits</span><span class="p">)</span><span class="si">}</span><span class="s2"> fits files in </span><span class="si">{</span><span class="n">DATAPATH</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">_f</span> <span class="ow">in</span> <span class="n">allfits</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">_f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found 7 fits files in ../../../Tutorial_Data.
../../../Tutorial_Data/20180413SAAO_p4179_010449.fits
../../../Tutorial_Data/20180413SAAO_p4179_010451.fits
../../../Tutorial_Data/20180413SAAO_p4179_010453.fits
../../../Tutorial_Data/20180413SAAO_p4179_010455.fits
../../../Tutorial_Data/20180413SAAO_p4179_010457.fits
../../../Tutorial_Data/20180413SAAO_p4179_010459.fits
../../../Tutorial_Data/20180413SAAO_p4179_010461.fits
</pre></div>
</div>
</div>
</div>
<section id="astropy-fits">
<h2><span class="section-number">1.1. </span><code class="docutils literal notranslate"><span class="pre">astropy.fits</span></code><a class="headerlink" href="#astropy-fits" title="Permalink to this headline">#</a></h2>
<p>You may have already learnt <code class="docutils literal notranslate"><span class="pre">astropy.fits</span></code> package from python preperation class. Here, I will review that and introduce a little bit more.</p>
<p>The official documentation of astropy is <a class="reference external" href="https://astropy.readthedocs.io/en/stable/">here</a>. Among those, we will learn about <a class="reference external" href="https://astropy.readthedocs.io/en/stable/io/fits/index.html"><code class="docutils literal notranslate"><span class="pre">astropy.io.fits</span></code></a> module, which is one of the greatest tool to handle FITS format.</p>
<p>Some information of the terms:
<strong>FITS</strong>
: See <a class="reference external" href="https://fits.gsfc.nasa.gov">this</a></p>
<dl class="simple myst">
<dt><strong>HDU</strong></dt><dd><p>Header Data Unit. An HDU is composed of Primary header (optionally with data) and other header &amp; data. The simplest one contains only the primary HDU.</p>
</dd>
<dt><strong>HDU List</strong></dt><dd><p>python <code class="docutils literal notranslate"><span class="pre">list</span></code> of the HDU objects</p>
</dd>
<dt><strong>MEF</strong></dt><dd><p>Multi-Extension FITS. In some cases, more than one such HDU is present in one FITS file. That is called the MEF. MEF is not recommended unless you are clearly aware of what you are doing.</p>
</dd>
<dt><strong>Header</strong></dt><dd><p>Contains information about the image. The most standard keywords are <a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/fcg/standard_dict.html">here</a> and others can be found at <a class="reference external" href="https://fits.gsfc.nasa.gov/fits_dictionary.html">here</a>. Few important ones are</p>
</dd>
</dl>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">OBJECT</span></code>: The name of the target</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DATE-OBS</span></code>: The time when the exposure started (in UT). Mostly in the format of <code class="docutils literal notranslate"><span class="pre">YYYY-MM-DDTHH:mm:ss</span></code> following <a class="reference external" href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a>, e.g., <code class="docutils literal notranslate"><span class="pre">2019-01-02T13:01:01</span></code> means it was taken on 2019 Jan 2nd, at 13:01:01. Sometimes (some observatories) only give YYYY-MM-DD or other unorthodox formats…</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EXPTIME</span></code>: The exposure time in seconds.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NAXIS1</span></code>: The number of pixels along the axis 1 (which is the X axis). Same for <code class="docutils literal notranslate"><span class="pre">NAXIS2</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FILTER</span></code>: Not a standard, but widely used to show the filter (e.g., <code class="docutils literal notranslate"><span class="pre">V</span></code> or <code class="docutils literal notranslate"><span class="pre">Johnson</span> <span class="pre">B</span></code>, etc).</p></li>
</ul>
<p>Some basic usages are as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">allfits</span><span class="p">:</span>
    <span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="n">hdul</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Filename: ../../../Tutorial_Data/20180413SAAO_p4179_010449.fits
No.    Name      Ver    Type      Cards   Dimensions   Format
  0  PRIMARY       1 PrimaryHDU     292   (999, 999)   float32   
  1  MASK          1 ImageHDU         8   (999, 999)   uint8   
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Filename: ../../../Tutorial_Data/20180413SAAO_p4179_010451.fits
No.    Name      Ver    Type      Cards   Dimensions   Format
  0  PRIMARY       1 PrimaryHDU     292   (999, 999)   float32   
  1  MASK          1 ImageHDU         8   (999, 999)   uint8   
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Filename: ../../../Tutorial_Data/20180413SAAO_p4179_010453.fits
No.    Name      Ver    Type      Cards   Dimensions   Format
  0  PRIMARY       1 PrimaryHDU     292   (999, 999)   float32   
  1  MASK          1 ImageHDU         8   (999, 999)   uint8   
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Filename: ../../../Tutorial_Data/20180413SAAO_p4179_010455.fits
No.    Name      Ver    Type      Cards   Dimensions   Format
  0  PRIMARY       1 PrimaryHDU     292   (999, 999)   float32   
  1  MASK          1 ImageHDU         8   (999, 999)   uint8   
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Filename: ../../../Tutorial_Data/20180413SAAO_p4179_010457.fits
No.    Name      Ver    Type      Cards   Dimensions   Format
  0  PRIMARY       1 PrimaryHDU     292   (999, 999)   float32   
  1  MASK          1 ImageHDU         8   (999, 999)   uint8   
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Filename: ../../../Tutorial_Data/20180413SAAO_p4179_010459.fits
No.    Name      Ver    Type      Cards   Dimensions   Format
  0  PRIMARY       1 PrimaryHDU     292   (999, 999)   float32   
  1  MASK          1 ImageHDU         8   (999, 999)   uint8   
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Filename: ../../../Tutorial_Data/20180413SAAO_p4179_010461.fits
No.    Name      Ver    Type      Cards   Dimensions   Format
  0  PRIMARY       1 PrimaryHDU     292   (999, 999)   float32   
  1  MASK          1 ImageHDU         8   (999, 999)   uint8   
</pre></div>
</div>
</div>
</div>
<p>As can be seen, each FITS file consist of two extensions called <code class="docutils literal notranslate"><span class="pre">PRIMARY</span></code> and <code class="docutils literal notranslate"><span class="pre">MASK</span></code>.</p>
<div class="tip admonition">
<p class="admonition-title">Practice</p>
<p>Think about what the code lines in the following code blocks mean</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Type of hdul:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">hdul</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hdul.info():&quot;</span><span class="p">)</span>
<span class="n">hdul</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Type of hdul:
&lt;class &#39;astropy.io.fits.hdu.hdulist.HDUList&#39;&gt;

hdul.info():
Filename: ../../../Tutorial_Data/20180413SAAO_p4179_010461.fits
No.    Name      Ver    Type      Cards   Dimensions   Format
  0  PRIMARY       1 PrimaryHDU     292   (999, 999)   float32   
  1  MASK          1 ImageHDU         8   (999, 999)   uint8   
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First 2x2 data of the 0-th element of hdul: hdul[0].data&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First 2x2 data of the 1-th element of hdul: hdul[1].data&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>First 2x2 data of the 0-th element of hdul: hdul[0].data
[[ 81.99481   78.62892 ]
 [107.25767   86.931755]]

First 2x2 data of the 1-th element of hdul: hdul[1].data
[[0 0]
 [0 0]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First 10 header keywords for hdul[0].header&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DATE-OBS (UT time of the **start** of the exposure) of hdul[0]: hdul[0].header[&#39;DATE-OBS&#39;]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;DATE-OBS&#39;</span><span class="p">])</span>

<span class="c1"># Close the HDU</span>
<span class="n">hdul</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>First 10 header keywords for hdul[0].header
[&#39;SIMPLE&#39;, &#39;BITPIX&#39;, &#39;NAXIS&#39;, &#39;NAXIS1&#39;, &#39;NAXIS2&#39;, &#39;EXTEND&#39;, &#39;ORIGIN&#39;, &#39;DATE&#39;, &#39;IRAF-TLM&#39;, &#39;OBJECT&#39;]

DATE-OBS (UT time of the **start** of the exposure) of hdul[0]: hdul[0].header[&#39;DATE-OBS&#39;]
2018-04-13T21:57:39
</pre></div>
</div>
</div>
</div>
<div class="tip admonition">
<p class="admonition-title">Practice</p>
<p>On the terminal, type</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fitsinfo 20180413SAAO_p4179_010449.fits 
</pre></div>
</div>
<p>at the directory where it is stored. Also try</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fitsheader 20180413SAAO_p4179_010449.fits[0]
</pre></div>
</div>
<p>and compare the results from the following code block’s result.</p>
</div>
<div class="tip admonition">
<p class="admonition-title">Practice</p>
<p>On the terminal, type</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ds9 -zscale 20180413SAAO_p4179_010449.fits[2] &amp; 
</pre></div>
</div>
<p>Confirm that this image is different from</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ds9 -zscale 20180413SAAO_p4179_010449.fits &amp; 
</pre></div>
</div>
<p>The rectangular bracket <code class="docutils literal notranslate"><span class="pre">[i]</span></code> shows the i-th extension data. If not given, ds9 shows the very first extension which contains data.</p>
</div>
<p>Example of header:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SIMPLE  =                    T / conforms to FITS standard                      
BITPIX  =                  -32 / array data type                                
NAXIS   =                    2 / number of array dimensions                     
NAXIS1  =                  999                                                  
NAXIS2  =                  999                                                  
EXTEND  =                    T                                                  
ORIGIN  = &#39;NOAO-IRAF FITS Image Kernel July 2003&#39; / FITS file originator        
DATE    = &#39;2018-05-15T05:12:02&#39; / Date FITS file was generated                  
IRAF-TLM= &#39;2018-05-15T05:12:02&#39; / Time of last modification                     
OBJECT  = &#39;A00360-TO&#39;          / Name of the object observed                    
BUNIT   = &#39;adu     &#39;           / units of physical values (LBT)                 
DETECTOR= &#39;e2v CCD290-99&#39;         / Detector name                               
NAMPS   =                    8 / Number of amplifiers in the detector           
GAINDL                         / Pixel integration time, in sequencer clocks    
PIXITIME                       / Pixel integration time, in seconds             
CCDXBIN =                    1 / CCD X-axis Binning Factor                      
CCDYBIN =                    1 / CCD Y-axis Binning Factor                      
OVERSCNX=                   32 / Horizontal overscan pixels per amplifier       
OVERSCNY=                    0 / Vertical overscan pixels                       
PRESCANX=                   27 / Horizontal prepixels per amplifier             
</pre></div>
</div>
</div>
</div>
<dl class="simple myst">
<dt><strong>Example</strong></dt><dd><p>As a practice, let’s calculate the mid-observation time. The middle of the observation is, of course, <strong>start time + exposure time / 2</strong>. To calculate this, you can use the following astropy functionalities:</p>
</dd>
</dl>
<ul class="simple">
<li><p><a class="reference external" href="http://docs.astropy.org/en/stable/time/"><code class="docutils literal notranslate"><span class="pre">astropy.time</span></code> module</a></p></li>
<li><p><a class="reference external" href="http://docs.astropy.org/en/stable/units/"><code class="docutils literal notranslate"><span class="pre">astropy.units</span></code> module</a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">obst</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;DATE-OBS&quot;</span><span class="p">])</span>
<span class="n">expt</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;EXPTIME&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The start of the observation time is  :&quot;</span><span class="p">,</span> <span class="n">obst</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The middle of the observation time is :&quot;</span><span class="p">,</span> <span class="n">obst</span> <span class="o">+</span> <span class="n">expt</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The end of the observation time is    :&quot;</span><span class="p">,</span> <span class="n">obst</span> <span class="o">+</span> <span class="n">expt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The start of the observation time is  : 2018-04-13T21:57:39.000
The middle of the observation time is : 2018-04-13T21:58:09.000
The end of the observation time is    : 2018-04-13T21:58:39.000
</pre></div>
</div>
</div>
</div>
</section>
<section id="displaying-data">
<h2><span class="section-number">1.2. </span>Displaying Data<a class="headerlink" href="#displaying-data" title="Permalink to this headline">#</a></h2>
<p>Using the <code class="docutils literal notranslate"><span class="pre">norm_imshow</span></code> defined in our tool, you can display image as ZScale in SAO DS9:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="p">(</span><span class="n">ImageNormalize</span><span class="p">,</span> <span class="n">LinearStretch</span><span class="p">,</span> <span class="n">ZScaleInterval</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">znorm</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="n">LinearStretch</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ImageNormalize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">ZScaleInterval</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">stretch</span><span class="o">=</span><span class="n">stretch</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">zimshow</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="n">LinearStretch</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="n">zscale_kw</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">znorm</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="n">stretch</span><span class="p">,</span> <span class="o">**</span><span class="n">zscale_kw</span><span class="p">),</span>
                   <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">im</span>


<span class="k">def</span> <span class="nf">norm_imshow</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span><span class="n">stretch</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> 
                <span class="n">asinh_a</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_percent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                <span class="n">max_percent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log_a</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> 
                <span class="n">invalid</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">zscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Do normalization and do imshow&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">zscale</span><span class="p">:</span>
        <span class="n">zs</span> <span class="o">=</span> <span class="n">ImageNormalize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">ZScaleInterval</span><span class="p">())</span>
        <span class="n">min_cut</span> <span class="o">=</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">zs</span><span class="o">.</span><span class="n">vmin</span>
        <span class="n">max_cut</span> <span class="o">=</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">zs</span><span class="o">.</span><span class="n">vmax</span>

    <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
            <span class="n">norm</span><span class="o">=</span><span class="n">simple_norm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="n">stretch</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="n">power</span><span class="p">,</span> 
                             <span class="n">asinh_a</span><span class="o">=</span><span class="n">asinh_a</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="n">min_cut</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="n">max_cut</span><span class="p">,</span> 
                             <span class="n">min_percent</span><span class="o">=</span><span class="n">min_percent</span><span class="p">,</span> <span class="n">max_percent</span><span class="o">=</span><span class="n">max_percent</span><span class="p">,</span> 
                             <span class="n">percent</span><span class="o">=</span><span class="n">percent</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="n">clip</span><span class="p">,</span> <span class="n">log_a</span><span class="o">=</span><span class="n">log_a</span><span class="p">,</span> 
                             <span class="n">invalid</span><span class="o">=</span><span class="n">invalid</span><span class="p">),</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">im</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">allfits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">vis</span><span class="o">.</span><span class="n">norm_imshow</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">zscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/696a61887643073b9255999155d2de001b44717716ed18453994997e60957da9.png" src="../_images/696a61887643073b9255999155d2de001b44717716ed18453994997e60957da9.png" />
</div>
</div>
<p>This itself is of course inferior to <code class="docutils literal notranslate"><span class="pre">ds9</span></code> and <code class="docutils literal notranslate"><span class="pre">ginga</span></code>, because we cannot do much interactive works.</p>
<div class="tip admonition">
<p class="admonition-title">Tip</p>
<p>If you want to use interactive Jupyter, do <code class="docutils literal notranslate"><span class="pre">%matplotlib</span> <span class="pre">notebook</span></code> or <code class="docutils literal notranslate"><span class="pre">%matplotlib</span> <span class="pre">widget</span></code> for Jypyter notebook and Jupyter-lab, respectively. Search for the Internet for details.</p>
</div>
</section>
<section id="making-new-fits-and-saving">
<h2><span class="section-number">1.3. </span>Making New FITS and Saving<a class="headerlink" href="#making-new-fits-and-saving" title="Permalink to this headline">#</a></h2>
<p>Consider, for some reason, you cropped the data and take a square-root, and want to save this as a FITS file. There are few ways to do this:</p>
<ol class="arabic simple">
<li><p>The most primitive way is to use python indexing to select some region, convert it to <code class="docutils literal notranslate"><span class="pre">astropy.fits.PrimaryHDU</span></code> object and save it.</p></li>
<li><p>A better way is to use some pre-made functions.</p>
<ol class="arabic simple">
<li><p>Such as <code class="docutils literal notranslate"><span class="pre">astropy.nddata.CutOut2D</span></code>. Unfortunately, however, they do not automatically update header.</p></li>
<li></li>
</ol>
</li>
</ol>
<section id="using-numpy-slicing">
<h3><span class="section-number">1.3.1. </span>Using Numpy Slicing<a class="headerlink" href="#using-numpy-slicing" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">allfits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">newdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">300</span><span class="p">:</span><span class="mi">400</span><span class="p">,</span> <span class="mi">650</span><span class="p">:</span><span class="mi">750</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">newdata</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">vis</span><span class="o">.</span><span class="n">norm_imshow</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">newdata</span><span class="p">,</span> <span class="n">zscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">vis</span><span class="o">.</span><span class="n">norm_imshow</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">newdata</span><span class="p">,</span> <span class="n">zscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;sqrt&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(100, 100)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/b1/mdnx6bfn6_v7p70xc3hpc9vh0000gn/T/ipykernel_77234/2916193753.py:3: RuntimeWarning: invalid value encountered in sqrt
  newdata = np.sqrt(data[300:400, 650:750])
</pre></div>
</div>
<img alt="../_images/111094c4ecef82d80dba78c1885ca502536d64b43f3b0e6057af89e5e83cafff.png" src="../_images/111094c4ecef82d80dba78c1885ca502536d64b43f3b0e6057af89e5e83cafff.png" />
</div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">[300:400,</span> <span class="pre">650:750]</span></code> will select 100x100 pixels.</p>
<p>Once you are happy, you can save it by the following code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">newhdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">newdata</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
<span class="n">newhdu</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;tmp&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.fits&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">output_verify</span><span class="o">=</span><span class="s1">&#39;fix&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For the options when writing with <code class="docutils literal notranslate"><span class="pre">.writeto</span></code>, refer to <a class="reference external" href="https://astropy.readthedocs.io/en/stable/io/fits/api/files.html#astropy.io.fits.writeto">the official document</a>).</p>
<div class="dropdown tip admonition">
<p class="admonition-title">Notes on Python numpy axis</p>
<p>Python array has the axis orientation shown below.</p>
<ul class="simple">
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y)</span> <span class="pre">=</span> <span class="pre">(2,</span> <span class="pre">3)</span></code> in <code class="docutils literal notranslate"><span class="pre">data</span></code> (the pixel at 2nd column 3rd row)  must be accessed by <code class="docutils literal notranslate"><span class="pre">data[2,</span> <span class="pre">1]</span></code> (xy swapped, decrease by 1)</p></li>
<li><p>Python slice contains the beginning index, but excludes the last index (<code class="docutils literal notranslate"><span class="pre">data[:3,</span> <span class="pre">0]</span></code> will result in <code class="docutils literal notranslate"><span class="pre">[data[0,</span> <span class="pre">0],</span> <span class="pre">data[1,</span> <span class="pre">0],</span> <span class="pre">data[2,</span> <span class="pre">0]]</span></code>, but <strong>NOT</strong> <code class="docutils literal notranslate"><span class="pre">data[3,</span> <span class="pre">0]</span></code>). Therefore, <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y)</span> <span class="pre">=</span> <span class="pre">(2~3,</span> <span class="pre">4~7)</span></code> (the 2 x 4 pixels at 2nd-3rd columns &amp; 4th-7th rows) must be accessed by <code class="docutils literal notranslate"><span class="pre">data[3:7,</span> <span class="pre">1:3]</span></code>.</p></li>
<li><p><strong>TIP</strong>: So you may reach a general formula. To select <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y)</span> <span class="pre">=</span> <span class="pre">(x1~x2,</span> <span class="pre">y1~y2)</span></code>, you have to use <code class="docutils literal notranslate"><span class="pre">data[y1-1:y2,</span> <span class="pre">x1-1:x2]</span></code>.</p></li>
</ul>
<p><img alt="" src="https://fgnt.github.io/python_crashkurs_doc/_images/numpy_array_t.png" />
▲ Note the axes order and indexing for 2-D array</p>
</div>
</section>
<section id="using-astropy-nddata-cutout2d">
<h3><span class="section-number">1.3.2. </span>Using <code class="docutils literal notranslate"><span class="pre">astropy.nddata.Cutout2D</span></code><a class="headerlink" href="#using-astropy-nddata-cutout2d" title="Permalink to this headline">#</a></h3>
<p>Tutorials on this module can be found at the official documentation on <a class="reference external" href="https://docs.astropy.org/en/stable/nddata/utils.html">image utilities</a>. Also <a class="reference external" href="https://docs.astropy.org/en/stable/api/astropy.nddata.Cutout2D.html">the official doc</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">astropy</span><span class="o">.</span><span class="n">nddata</span><span class="o">.</span><span class="n">Cutout2D</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;trim&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">nan</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Cutout2D</span></code> is not easy to deal with — it is not a <code class="docutils literal notranslate"><span class="pre">CCDData</span></code> nor <code class="docutils literal notranslate"><span class="pre">HDU</span></code>-like type. Thus, I made a simple function to convert it to <code class="docutils literal notranslate"><span class="pre">CCDData</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">Cutout2D</span>
<span class="kn">from</span> <span class="nn">astropy.wcs</span> <span class="kn">import</span> <span class="n">WCS</span>


<span class="k">def</span> <span class="nf">cut_ccd</span><span class="p">(</span><span class="n">ccd</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;trim&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Converts the Cutout2D object to proper CCDData.&quot;&quot;&quot;</span>
    <span class="n">cutout</span> <span class="o">=</span> <span class="n">Cutout2D</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">ccd</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
        <span class="n">wcs</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ccd</span><span class="p">,</span> <span class="s2">&quot;wcs&quot;</span><span class="p">,</span> <span class="n">WCS</span><span class="p">(</span><span class="n">ccd</span><span class="o">.</span><span class="n">header</span><span class="p">)),</span>
        <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># Copy True just to avoid any contamination to the original ccd.</span>

    <span class="n">nccd</span> <span class="o">=</span> <span class="n">CCDData</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">cutout</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">ccd</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                   <span class="n">wcs</span><span class="o">=</span><span class="n">cutout</span><span class="o">.</span><span class="n">wcs</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">ccd</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
    <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">nccd</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">nccd</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;NAXIS1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nx</span>
    <span class="n">nccd</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;NAXIS2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ny</span>
    <span class="n">nccd</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;LTV1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nccd</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LTV1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">cutout</span><span class="o">.</span><span class="n">origin_original</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nccd</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;LTV2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nccd</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LTV2&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">cutout</span><span class="o">.</span><span class="n">origin_original</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">nccd</span>


<span class="n">ccd</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">allfits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">cut</span> <span class="o">=</span> <span class="n">cut_ccd</span><span class="p">(</span><span class="n">ccd</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">350</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cut</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">cut</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cut</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">vis</span><span class="o">.</span><span class="n">norm_imshow</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cut</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">zscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">vis</span><span class="o">.</span><span class="n">norm_imshow</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cut</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">zscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;sqrt&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: FITSFixedWarning: RADECSYS= &#39;ICRS &#39; / Telescope Coordinate System 
the RADECSYS keyword is deprecated, use RADESYSa. [astropy.wcs.wcs]
/var/folders/b1/mdnx6bfn6_v7p70xc3hpc9vh0000gn/T/ipykernel_77234/2677194592.py:28: RuntimeWarning: invalid value encountered in sqrt
  cut.data = np.sqrt(cut.data)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(100, 100)
</pre></div>
</div>
<img alt="../_images/111094c4ecef82d80dba78c1885ca502536d64b43f3b0e6057af89e5e83cafff.png" src="../_images/111094c4ecef82d80dba78c1885ca502536d64b43f3b0e6057af89e5e83cafff.png" />
</div>
</div>
<p>Because <code class="docutils literal notranslate"><span class="pre">cut</span></code> is now <code class="docutils literal notranslate"><span class="pre">CCDData</span></code>, you may use <code class="docutils literal notranslate"><span class="pre">.write</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;tmp&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;test.fits&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">output_verify</span><span class="o">=</span><span class="s1">&#39;fix&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="iraf-like-slicing">
<h3><span class="section-number">1.3.3. </span>IRAF-like Slicing<a class="headerlink" href="#iraf-like-slicing" title="Permalink to this headline">#</a></h3>
<p>In IRAF, there is a task named <a class="reference external" href="https://iraf.readthedocs.io/en/latest/tasks/images/imutil/imcopy.html"><code class="docutils literal notranslate"><span class="pre">IMCOPY</span></code></a>.</p>
<p>I made two similar functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ysfitsutilpy</span><span class="o">.</span><span class="n">imslice</span><span class="p">(</span><span class="n">ccd</span><span class="p">,</span> <span class="n">trimsec</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order_xyz</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">update_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ysfitsutilpy</span><span class="o">.</span><span class="n">imcopy</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">trimsecs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">return_ccd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">update_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">imslice</span></code> is the most basic, pythonic way of slicing a part of %he image based on <code class="docutils literal notranslate"><span class="pre">trimsec</span></code>. <code class="docutils literal notranslate"><span class="pre">trimsec</span></code> can be one of</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">str</span></code>: The FITS convention section to trim (e.g., IRAF TRIMSEC).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[list</span> <span class="pre">of]</span> <span class="pre">int</span></code>: The number of pixels to trim from the edge of the image (bezel). If list, it must be [bezel_lower, bezel_upper].</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[list</span> <span class="pre">of]</span> <span class="pre">slice</span></code>: The slice of each axis (<code class="docutils literal notranslate"><span class="pre">slice(start,</span> <span class="pre">stop,</span> <span class="pre">step)</span></code>)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">imcopy</span></code> is basically a copycat of IRAF, and it uses <code class="docutils literal notranslate"><span class="pre">imslice</span></code> under the hood, so you may just stick to <code class="docutils literal notranslate"><span class="pre">imslice</span></code> unless you have specific reasons. It accepts the [list of] file name[s] or CCDData.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ccd</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">allfits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">cut</span> <span class="o">=</span> <span class="n">yfu</span><span class="o">.</span><span class="n">imslice</span><span class="p">(</span><span class="n">ccd</span><span class="p">,</span> <span class="n">trimsec</span><span class="o">=</span><span class="s2">&quot;[650:749, 300:399]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cut</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">cut</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cut</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">vis</span><span class="o">.</span><span class="n">norm_imshow</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cut</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">zscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">vis</span><span class="o">.</span><span class="n">norm_imshow</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cut</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">zscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;sqrt&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: FITSFixedWarning: RADECSYS= &#39;ICRS &#39; / Telescope Coordinate System 
the RADECSYS keyword is deprecated, use RADESYSa. [astropy.wcs.wcs]
/var/folders/b1/mdnx6bfn6_v7p70xc3hpc9vh0000gn/T/ipykernel_77234/1339730229.py:4: RuntimeWarning: invalid value encountered in sqrt
  cut.data = np.sqrt(cut.data)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(100, 100)
</pre></div>
</div>
<img alt="../_images/19c1f3b657b83e04b75d8f6de1bd112b7dccc558d5fbc34144562fe1b24c0d07.png" src="../_images/19c1f3b657b83e04b75d8f6de1bd112b7dccc558d5fbc34144562fe1b24c0d07.png" />
</div>
</div>
<p>Note than you had to use 749 and 399 instead of 750 and 400. This is because the traditional FITS section (IRAF section) is 1-indexing, and includes the last number. For example, to select the first pixel, python would use <code class="docutils literal notranslate"><span class="pre">[0:1,</span> <span class="pre">0:1]</span></code> while traditional IRAF would use <code class="docutils literal notranslate"><span class="pre">[1:1,</span> <span class="pre">1:1]</span></code>.</p>
<p>There is a tool to convert IRAF-like section into python, but not the inverse.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">astro_ndslice</span> <span class="k">as</span> <span class="nn">nds</span>
<span class="n">arr2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">a_slice</span> <span class="o">=</span> <span class="n">nds</span><span class="o">.</span><span class="n">slice_from_string</span><span class="p">(</span><span class="s1">&#39;[1:3, 1:4]&#39;</span><span class="p">,</span> <span class="n">fits_convention</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">arr2d</span><span class="p">[</span><span class="n">a_slice</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 0,  1,  2],
       [10, 11, 12],
       [20, 21, 22],
       [30, 31, 32]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a_slice</span> <span class="o">=</span> <span class="n">nds</span><span class="o">.</span><span class="n">slice_from_string</span><span class="p">(</span><span class="s1">&#39;[1:10:2, 1:4]&#39;</span><span class="p">,</span> <span class="n">fits_convention</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">arr2d</span><span class="p">[</span><span class="n">a_slice</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 0,  2,  4,  6,  8],
       [10, 12, 14, 16, 18],
       [20, 22, 24, 26, 28],
       [30, 32, 34, 36, 38]])
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chaps"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="python_prep/03-FITS_and_astropy.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">4.6. </span>About <code class="docutils literal notranslate"><span class="pre">astropy.fits</span></code></p>
      </div>
    </a>
    <a class="right-next"
       href="02-center.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">2. </span>Centering</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#astropy-fits">1.1. <code class="docutils literal notranslate"><span class="pre">astropy.fits</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#displaying-data">1.2. Displaying Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#making-new-fits-and-saving">1.3. Making New FITS and Saving</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-numpy-slicing">1.3.1. Using Numpy Slicing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-astropy-nddata-cutout2d">1.3.2. Using <code class="docutils literal notranslate"><span class="pre">astropy.nddata.Cutout2D</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iraf-like-slicing">1.3.3. IRAF-like Slicing</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Yoonsoo P. Bach
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>